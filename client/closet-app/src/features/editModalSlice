import { createSlice } from '@reduxjs/toolkit';
import axios from 'axios';

const initialState = {
  editModalVisibility: false,
  editImage: null,
  uniqueCategories: null,
};

// Thunk action to delete items
export const editCategory = (imageId, category) => async (dispatch) => {
    console.log("edit Items before try");
    dispatch(editImageStart());
    console.log("category", category);
    dispatch(editImage(imageId, category));
    console.log("new category", category);
    try {
      const response = await axios.put(`https://kristobaricevic.com/api/images/${imageId}`, {category});
  
      console.log(response);
      console.log("delete items slice with ", imageId);
  
      dispatch(editItemsSuccess());
    } catch (error) {
      dispatch(editItemsFailure(error));
    }
  };

const editModalSlice = createSlice({
  name: 'editModal',
  initialState,
  reducers: {
    setEditModalVisibility: (state, action) => {
        state.editModalVisibility = action.payload;
    },
    setEditImage: (state, action) => {
        state.editImage = action.payload;
    },
    setCategory: (state, action) => {
        state.editImage.category = action.payload;
    },
    closeEditModal: (state, action) => {
        state.editModalVisibility = action.payload;
    },
    setUniqueCategories: (state, action) => {
        state.uniqueCategories = action.payload;
    },
    editImage: (state, action) => {
        const { id, category } = action.payload;
        const imageToEdit = state.images.find(image => image.id === id);
        if (imageToEdit) {
            imageToEdit.category = category;
        }
    },
    editImageStart: (state) => {
        state.loading = true;
        state.error = null;
    },
    editItemsSuccess: (state) => {
        state.loading = false;
        state.error = null;
    },
    editItemsFailure: (state, action) => {
        state.loading = false;
        state.error = action.payload;
    },
  },
});

export const {
    closeEditModal,    
    setEditModalVisibility,
    setUniqueCategories,
    setEditImage,
    editImage,
    editImageStart,
    editItemsFailure,
    editItemsSuccess,
    setCategory,
} = editModalSlice.actions;

export const editModalVisibility = (state) => state.editModal.editModalVisibility;
export const editingImage = (state) => state.editModal.editModalImage;
export const categories = (state) => state.editModal.uniqueCategories;

export const editModalReducer = editModalSlice.reducer;
